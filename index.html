<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Cr√©dito ‚Äî Leitor</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet"/>
<style>
*{box-sizing:border-box;margin:0;padding:0}
html,body{min-height:100%;font-family:'Inter',sans-serif;background:#f6f7f9;color:#1a1f2e}
button{font-family:inherit;cursor:pointer;border:none;background:none}
input{font-family:inherit}
a{text-decoration:none;color:inherit}

.wrap{max-width:680px;margin:0 auto;padding:36px 20px 80px}

/* header */
.hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:32px}
.logo{display:flex;align-items:center;gap:10px}
.logo-mark{width:36px;height:36px;background:#1a1f2e;border-radius:10px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:15px;font-family:'JetBrains Mono',monospace;flex-shrink:0}
.logo-name{font-size:15px;font-weight:700;letter-spacing:-.3px}
.logo-sub{font-size:11px;color:#94a3b8;margin-top:1px}
.cfg-btn{width:34px;height:34px;border-radius:8px;border:1px solid #e2e8f0;display:flex;align-items:center;justify-content:center;color:#94a3b8;transition:all .15s}
.cfg-btn:hover{background:#fff;color:#1a1f2e;border-color:#cbd5e1}

/* input card */
.card{background:#fff;border:1px solid #e2e8f0;border-radius:14px;padding:20px;margin-bottom:20px;box-shadow:0 1px 3px rgba(0,0,0,.04)}
.card:focus-within{border-color:#818cf8;box-shadow:0 0 0 3px rgba(129,140,248,.1)}
.row{display:flex;gap:10px;align-items:flex-end}
.lbl{font-size:10px;font-weight:700;color:#94a3b8;text-transform:uppercase;letter-spacing:.7px;margin-bottom:6px;display:block}
.url-inp{flex:1;border:1px solid #e2e8f0;border-radius:8px;padding:10px 13px;font-size:13px;color:#1a1f2e;outline:none;transition:border-color .15s;background:#fafbfc}
.url-inp:focus{border-color:#818cf8;background:#fff}
.url-inp::placeholder{color:#cbd5e1}
.sep{font-size:11px;color:#cbd5e1;padding-bottom:6px;flex-shrink:0}
.pdf-lbl{display:flex;align-items:center;gap:5px;font-size:12px;font-weight:600;color:#6366f1;border:1.5px dashed #c7d2fe;border-radius:8px;padding:9px 13px;cursor:pointer;transition:all .15s;white-space:nowrap;background:#fafbff}
.pdf-lbl:hover{background:#eef2ff;border-color:#a5b4fc}
.pdf-lbl.ok{border-style:solid;background:#f0fdf4;color:#16a34a;border-color:#86efac}
.go-btn{display:flex;align-items:center;justify-content:center;gap:6px;width:100%;margin-top:14px;padding:11px;background:#1a1f2e;color:#fff;border-radius:9px;font-size:13px;font-weight:600;transition:background .15s}
.go-btn:hover:not(:disabled){background:#2d3748}
.go-btn:disabled{opacity:.35;cursor:not-allowed}
.go-btn.busy{background:#6366f1}
.err{font-size:11px;color:#ef4444;margin-top:8px;display:none}
input[type=file]{display:none}

/* stats */
.stats{font-size:11px;color:#94a3b8;margin-bottom:12px}
.stats b{color:#1a1f2e}

/* article card */
.art{background:#fff;border:1px solid #e2e8f0;border-radius:12px;margin-bottom:8px;overflow:hidden;transition:border-color .15s}
.art:hover{border-color:#cbd5e1}
.art-top{display:flex;align-items:flex-start;gap:10px;padding:13px 15px;cursor:pointer}
.art-info{flex:1;min-width:0}
.art-meta{display:flex;align-items:center;gap:5px;margin-bottom:4px;flex-wrap:wrap}
.src{font-size:10px;font-weight:700;color:#6366f1;text-transform:uppercase;letter-spacing:.5px;font-family:'JetBrains Mono',monospace}
.dt{font-size:10px;color:#cbd5e1}
.rel{font-size:9px;font-weight:700;padding:2px 6px;border-radius:4px;font-family:'JetBrains Mono',monospace;letter-spacing:.3px}
.rel-alta{background:#fef2f2;color:#b91c1c}
.rel-media{background:#fffbeb;color:#b45309}
.rel-baixa{background:#f8fafc;color:#64748b}
.art-title{font-size:13px;font-weight:600;color:#0f172a;line-height:1.45}
.art-actions{display:flex;gap:4px;align-items:center;flex-shrink:0}
.del-btn{color:#e2e8f0;padding:3px;border-radius:5px;transition:color .15s}
.del-btn:hover{color:#ef4444}
.chev{color:#e2e8f0;transition:transform .2s}
.chev.open{transform:rotate(90deg)}

/* expanded body */
.art-body{padding:0 15px 15px;border-top:1px solid #f8fafc}
.tese-box{background:#f8f9ff;border-left:3px solid #818cf8;padding:9px 12px;border-radius:0 7px 7px 0;margin:11px 0 10px;font-size:12px;color:#3730a3;line-height:1.6;font-style:italic}
.sec{font-size:9.5px;font-weight:700;color:#cbd5e1;text-transform:uppercase;letter-spacing:.8px;margin:12px 0 5px;font-family:'JetBrains Mono',monospace}
.bullets{list-style:none}
.bullets li{display:flex;gap:7px;font-size:12px;color:#374151;line-height:1.6;margin-bottom:3px}
.bullets li::before{content:'‚Ä∫';color:#a5b4fc;font-weight:700;flex-shrink:0}
.ins-row{display:flex;gap:7px;align-items:flex-start;padding:6px 9px;border-radius:6px;background:#fafbfc;border:1px solid #f1f5f9;margin-bottom:4px}
.ins-cat{font-size:9px;font-weight:700;padding:2px 5px;border-radius:4px;flex-shrink:0;margin-top:1px;text-transform:uppercase;letter-spacing:.3px;font-family:'JetBrains Mono',monospace}
.c-macro{background:#dbeafe;color:#1e40af}
.c-setor{background:#dcfce7;color:#166534}
.c-regulat√≥rio{background:#f3e8ff;color:#6b21a8}
.c-estrat√©gia{background:#fef9c3;color:#854d0e}
.c-risco{background:#ffe4e6;color:#9f1239}
.c-oportunidade{background:#d1fae5;color:#065f46}
.ins-txt{font-size:11px;color:#374151;line-height:1.5}
.reg-box{border-radius:6px;padding:8px 10px;margin-bottom:4px}
.reg-bcb{background:#eff6ff;border:1px solid #bfdbfe}
.reg-cvm{background:#f5f3ff;border:1px solid #ddd6fe}
.reg-org{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;font-family:'JetBrains Mono',monospace}
.reg-bcb .reg-org{color:#1d4ed8}
.reg-cvm .reg-org{color:#6d28d9}
.reg-name{font-size:11px;font-weight:600;color:#1e293b;margin:2px 0}
.reg-desc{font-size:10px;color:#64748b;line-height:1.5}
.tags{display:flex;flex-wrap:wrap;gap:4px;margin-top:8px}
.tag{font-size:10px;padding:2px 8px;background:#f1f5f9;border-radius:999px;color:#64748b;font-family:'JetBrains Mono',monospace}
.art-link{display:flex;align-items:center;gap:4px;font-size:10px;color:#6366f1;margin-top:10px}
.art-link:hover{text-decoration:underline}

/* empty */
.empty{text-align:center;padding:56px 20px;color:#94a3b8}
.empty-ico{font-size:36px;margin-bottom:12px;opacity:.4}
.empty-ttl{font-size:14px;font-weight:600;color:#64748b;margin-bottom:6px}
.empty-sub{font-size:12px;line-height:1.7}

/* modal */
.overlay{position:fixed;inset:0;background:rgba(15,23,42,.5);display:flex;align-items:center;justify-content:center;z-index:99;padding:20px;backdrop-filter:blur(4px)}
.modal{background:#fff;border-radius:14px;width:100%;max-width:400px;box-shadow:0 20px 50px rgba(0,0,0,.2)}
.mhd{display:flex;align-items:center;justify-content:space-between;padding:15px 18px;border-bottom:1px solid #f1f5f9}
.mhd-title{font-size:14px;font-weight:700}
.mbody{padding:16px 18px;display:flex;flex-direction:column;gap:12px}
.mft{padding:0 18px 16px;display:flex;justify-content:flex-end;gap:8px}
.field-input{width:100%;border:1px solid #e2e8f0;border-radius:8px;padding:9px 12px;font-size:13px;outline:none;transition:border-color .15s}
.field-input:focus{border-color:#818cf8}
.hint{font-size:10px;color:#94a3b8;line-height:1.6;margin-top:5px}
.m-btn{border-radius:8px;padding:8px 16px;font-size:13px;font-weight:600;transition:all .15s}
.m-btn-primary{background:#1a1f2e;color:#fff}
.m-btn-primary:hover{background:#2d3748}
.m-btn-ghost{color:#64748b}
.m-btn-ghost:hover{background:#f1f5f9}
.exp-row{display:flex;gap:8px}
.exp-btn{flex:1;display:flex;align-items:center;justify-content:center;gap:5px;border:1px solid #e2e8f0;border-radius:8px;padding:8px;font-size:12px;font-weight:600;color:#475569;transition:all .15s;cursor:pointer}
.exp-btn:hover{background:#f8fafc;border-color:#cbd5e1}
.imp-status{font-size:11px;margin-top:6px;display:none}

/* quotes */
.quote-block{border-left:3px solid #e2e8f0;padding:10px 14px;margin-bottom:6px;background:#fafbfc;border-radius:0 8px 8px 0}
.quote-text{font-size:12px;color:#374151;line-height:1.7;font-style:italic;margin-bottom:5px}
.quote-attr{font-size:10px;color:#94a3b8;font-weight:600;font-family:'JetBrains Mono',monospace}
.quote-attr span{color:#6366f1}

/* micro details */
.micro-grid{display:flex;flex-direction:column;gap:4px}
.micro-row{display:flex;gap:8px;align-items:baseline;padding:5px 9px;border-radius:6px;background:#fafbfc;border:1px solid #f1f5f9}
.micro-tipo{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.4px;padding:2px 5px;border-radius:4px;flex-shrink:0;font-family:'JetBrains Mono',monospace;white-space:nowrap}
.t-valor{background:#dbeafe;color:#1e40af}
.t-prazo{background:#fef9c3;color:#854d0e}
.t-rating{background:#d1fae5;color:#065f46}
.t-spread{background:#ede9fe;color:#5b21b6}
.t-emissor{background:#fff7ed;color:#c2410c}
.t-estrutura{background:#f0fdf4;color:#15803d}
.t-regula√ß√£o{background:#f3e8ff;color:#6b21a8}
.t-outro{background:#f1f5f9;color:#475569}
.micro-txt{font-size:11px;color:#374151;line-height:1.5}
@keyframes spin{to{transform:rotate(360deg)}}
.spin{animation:spin .8s linear infinite;display:inline-block}
</style>
</head>
<body>
<div class="wrap">

  <div class="hdr">
    <div class="logo">
      <div class="logo-mark">‚Ç°</div>
      <div>
        <div class="logo-name">Cr√©dito Privado</div>
        <div class="logo-sub">Leitor de mat√©rias</div>
      </div>
    </div>
    <button class="cfg-btn" id="btn-cfg" title="Configura√ß√µes">
      <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
    </button>
  </div>

  <div class="card">
    <div class="row">
      <div style="flex:1">
        <label class="lbl">URL da mat√©ria</label>
        <input class="url-inp" id="url-inp" type="url" placeholder="https://braziljournal.com/..."/>
      </div>
      <span class="sep">ou</span>
      <div>
        <label class="lbl">PDF</label>
        <label class="pdf-lbl" id="pdf-lbl">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"/></svg>
          <span id="pdf-txt">Subir PDF</span>
          <input type="file" id="pdf-inp" accept="application/pdf"/>
        </label>
      </div>
    </div>
    <p class="err" id="err-msg"></p>
    <button class="go-btn" id="go-btn" disabled>
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
      Analisar e salvar
    </button>
  </div>

  <div id="list"></div>
</div>

<!-- MODAL -->
<div class="overlay" id="modal" style="display:none">
  <div class="modal">
    <div class="mhd">
      <span class="mhd-title">Configura√ß√µes</span>
      <button id="btn-close-modal" style="color:#94a3b8;cursor:pointer">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18M6 6l12 12"/></svg>
      </button>
    </div>
    <div class="mbody">
      <div>
        <label class="lbl">Chave de API Anthropic</label>
        <input class="field-input" id="key-inp" type="password" placeholder="sk-ant-api03-..."/>
        <p class="hint">Guardada s√≥ no seu navegador. Crie em <a href="https://console.anthropic.com/api-keys" target="_blank" style="color:#6366f1">console.anthropic.com/api-keys</a></p>
      </div>
      <div>
        <label class="lbl" style="margin-bottom:8px">Backup</label>
        <div class="exp-row">
          <button class="exp-btn" id="btn-export">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
            Exportar
          </button>
          <label class="exp-btn" style="cursor:pointer">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"/></svg>
            Importar
            <input type="file" id="imp-inp" accept=".json" style="display:none"/>
          </label>
        </div>
        <p class="imp-status" id="imp-status"></p>
      </div>
    </div>
    <div class="mft">
      <button class="m-btn m-btn-ghost" id="btn-cancel">Cancelar</button>
      <button class="m-btn m-btn-primary" id="btn-save">Salvar</button>
    </div>
  </div>
</div>

<script>
/* storage */
const S = {
  set: (k,v) => localStorage.setItem(k, JSON.stringify(v)),
  get: (k)   => { try { const v=localStorage.getItem(k); return v?JSON.parse(v):null; }catch{return null;} },
  del: (k)   => localStorage.removeItem(k),
  list:(p)   => Object.keys(localStorage).filter(k=>k.startsWith(p)),
};

let arts = [];
let pdf  = null;
let open = {};

function load() {
  arts = S.list('a:').map(k=>S.get(k)).filter(Boolean)
         .sort((a,b)=>new Date(b.at)-new Date(a.at));
  render();
  if (!S.get('__key__')) showModal();
}

/* api */
async function api(body) {
  const k = S.get('__key__');
  if (!k) { showModal(); throw new Error('Configure a chave de API.'); }
  const headers = {
    'Content-Type': 'application/json',
    'x-api-key': k,
    'anthropic-version': '2023-06-01',
    'anthropic-dangerous-direct-browser-access': 'true',
    'anthropic-beta': 'pdfs-2024-09-25',
  };
  const r = await fetch('https://api.anthropic.com/v1/messages', {
    method:'POST', headers, body: JSON.stringify(body),
  });
  if (!r.ok) { const e=await r.json().catch(()=>({})); throw new Error(e?.error?.message||`HTTP ${r.status}`); }
  return r.json();
}

/* analyze */
async function analyze() {
  const url = document.getElementById('url-inp').value.trim();
  const err = document.getElementById('err-msg');
  err.style.display = 'none';
  const btn = document.getElementById('go-btn');
  btn.disabled = true; btn.classList.add('busy');
  btn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="spin"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg> Analisando‚Ä¶';

  try {
    const prev = arts.slice(0,8).map(a=>`[${a.id}] "${a.title}"`).join('\n');
    const prompt = `Voc√™ √© analista s√™nior de cr√©dito privado brasileiro. Analise ${pdf?'o PDF em anexo':'a mat√©ria da URL abaixo'} com profundidade e retorne SOMENTE JSON v√°lido sem backticks.
${url?`URL: ${url}\n`:''}${!pdf?'Acesse a URL e extraia o conte√∫do completo.\n':''}
Mat√©rias anteriores (para detectar conex√µes):
${prev||'Nenhuma.'}

INSTRU√á√ïES:
- "resumo": 6-8 bullets detalhados. Cada bullet deve ser rico, com n√∫meros, percentuais, nomes de empresas, prazos e contexto espec√≠fico mencionados no artigo. N√£o generalize ‚Äî cite os fatos exatos.
- "detalhes_micro": fatos granulares e t√©cnicos do artigo: valores (R$, %), datas, nomes de instrumentos (FIDC, CRI, CRA, deb√™ntures), spreads, ratings, emissores, estruturas ‚Äî tudo que for espec√≠fico e acion√°vel.
- "citacoes": frases literais ou parafraseadas de pessoas citadas no artigo (executivos, gestores, reguladores, analistas). Inclua nome e cargo/empresa de quem disse.
- "insights": 3-5 insights acion√°veis para quem opera cr√©dito privado.

JSON:
{
  "title": "t√≠tulo exato da mat√©ria",
  "source": "ve√≠culo/portal",
  "relevancia": "alta|media|baixa",
  "tese": "argumento central em 1-2 frases densas",
  "resumo": [
    "bullet detalhado com fatos espec√≠ficos, n√∫meros e contexto",
    "bullet 2", "bullet 3", "bullet 4", "bullet 5", "bullet 6"
  ],
  "detalhes_micro": [
    {"item": "descri√ß√£o do detalhe t√©cnico ou n√∫mero espec√≠fico", "tipo": "valor|prazo|rating|spread|emissor|estrutura|regula√ß√£o|outro"}
  ],
  "citacoes": [
    {"frase": "texto da cita√ß√£o ou par√°frase fiel", "pessoa": "Nome da Pessoa", "cargo": "Cargo ‚Äî Empresa"}
  ],
  "insights": [
    {"texto": "insight acion√°vel para cr√©dito privado", "categoria": "macro|setor|regulat√≥rio|estrat√©gia|risco|oportunidade"}
  ],
  "tags": ["tag1","tag2","tag3","tag4"],
  "regulacoes": [
    {"orgao": "BCB|CVM", "norma": "nome da norma ou resolu√ß√£o", "relevancia": "impacto espec√≠fico para o mercado"}
  ],
  "conexoes": []
}`;

    const content = pdf
      ? [
          {
            type: 'document',
            source: { type: 'base64', media_type: 'application/pdf', data: pdf.b64 },
            cache_control: { type: 'ephemeral' }
          },
          { type: 'text', text: prompt }
        ]
      : prompt;

    const data = await api({model:'claude-sonnet-4-20250514',max_tokens:2000,messages:[{role:'user',content}]});
    const raw  = (data.content||[]).filter(b=>b.type==='text').map(b=>b.text).join('');
    const p    = JSON.parse(raw.replace(/```json|```/g,'').trim());

    p.resumo         = p.resumo         || [];
    p.detalhes_micro = p.detalhes_micro || [];
    p.citacoes       = p.citacoes       || [];
    p.insights       = p.insights       || [];
    p.tags           = p.tags           || [];
    p.regulacoes     = p.regulacoes     || [];
    p.conexoes       = p.conexoes       || [];

    const id  = `a:${Date.now()}`;
    const art = {id, url, at: new Date().toISOString(), ...p};
    S.set(id, art);

    for (const cid of p.conexoes) {
      const ex = arts.find(a=>a.id===cid);
      if (ex) { const u={...ex,conexoes:[...new Set([...(ex.conexoes||[]),id])]}; S.set(cid,u); arts[arts.findIndex(a=>a.id===cid)]=u; }
    }

    arts = [art, ...arts];
    open[id] = true;
    document.getElementById('url-inp').value = '';
    pdf = null;
    document.getElementById('pdf-txt').textContent = 'Subir PDF';
    document.getElementById('pdf-lbl').classList.remove('ok');
    render();
  } catch(e) {
    err.textContent = e.message||'Erro. Tente novamente.';
    err.style.display = 'block';
  }

  btn.classList.remove('busy'); btn.disabled = !document.getElementById('url-inp').value && !pdf;
  btn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg> Analisar e salvar';
}

/* render */
const CC = {macro:'c-macro',setor:'c-setor','regulat√≥rio':'c-regulat√≥rio','estrat√©gia':'c-estrat√©gia',risco:'c-risco',oportunidade:'c-oportunidade'};

function render() {
  const el = document.getElementById('list');
  if (!arts.length) {
    el.innerHTML = '<div class="empty"><div class="empty-ico">üìÑ</div><div class="empty-ttl">Nenhuma mat√©ria salva ainda</div><div class="empty-sub">Cole uma URL ou envie um PDF acima.<br/>A IA gera o resumo e salva automaticamente.</div></div>';
    return;
  }
  el.innerHTML = `<p class="stats"><b>${arts.length}</b> mat√©ria${arts.length!==1?'s':''} salva${arts.length!==1?'s':''}</p>` +
  arts.map(a => {
    const isOpen = open[a.id];
    const rc = a.relevancia==='alta'?'rel-alta':a.relevancia==='media'?'rel-media':'rel-baixa';
    const dt = new Date(a.at).toLocaleDateString('pt-BR',{day:'2-digit',month:'short'});
    const body = isOpen ? `<div class="art-body">
      ${a.tese?`<div class="tese-box">${a.tese}</div>`:''}
      ${a.resumo?.length?`<div class="sec">Resumo</div><ul class="bullets">${a.resumo.map(b=>`<li>${b}</li>`).join('')}</ul>`:''}
      ${a.detalhes_micro?.length?`
        <div class="sec">Dados & Detalhes</div>
        <div class="micro-grid">${a.detalhes_micro.map(d=>{
          const tc = 't-'+(d.tipo||'outro');
          return `<div class="micro-row"><span class="micro-tipo ${tc}">${d.tipo||'dado'}</span><span class="micro-txt">${d.item}</span></div>`;
        }).join('')}</div>`:''}
      ${a.citacoes?.length?`
        <div class="sec">Falas em Destaque</div>
        ${a.citacoes.map(c=>`
          <div class="quote-block">
            <div class="quote-text">"${c.frase}"</div>
            <div class="quote-attr"><span>${c.pessoa}</span>${c.cargo?` ‚Äî ${c.cargo}`:''}</div>
          </div>`).join('')}`:''}
      ${a.insights?.length?`<div class="sec">Insights para Cr√©dito Privado</div>${a.insights.map(i=>`<div class="ins-row"><span class="ins-cat ${CC[i.categoria]||''}">${i.categoria}</span><span class="ins-txt">${i.texto}</span></div>`).join('')}`:''}
      ${a.regulacoes?.length?`<div class="sec">Regula√ß√µes BCB/CVM</div>${a.regulacoes.map(r=>`<div class="reg-box ${r.orgao==='CVM'?'reg-cvm':'reg-bcb'}"><div class="reg-org">${r.orgao}</div><div class="reg-name">${r.norma}</div><div class="reg-desc">${r.relevancia||''}</div></div>`).join('')}`:''}
      ${a.tags?.length?`<div class="tags">${a.tags.map(t=>`<span class="tag">${t}</span>`).join('')}</div>`:''}
      ${a.url?`<a class="art-link" href="${a.url}" target="_blank"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6M15 3h6v6M10 14 21 3"/></svg> Ver original</a>`:''}
    </div>` : '';

    return `<div class="art" id="c-${a.id}">
      <div class="art-top" onclick="tog('${a.id}')">
        <div class="art-info">
          <div class="art-meta">
            <span class="src">${a.source||'‚Äî'}</span>
            <span class="dt">${dt}</span>
            <span class="rel ${rc}">${(a.relevancia||'‚Äî').toUpperCase()}</span>
          </div>
          <div class="art-title">${a.title}</div>
        </div>
        <div class="art-actions">
          <button class="del-btn" onclick="event.stopPropagation();del('${a.id}')">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
          </button>
          <svg class="chev ${isOpen?'open':''}" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m9 18 6-6-6-6"/></svg>
        </div>
      </div>${body}</div>`;
  }).join('');
}

function tog(id) { open[id]=!open[id]; render(); }
function del(id) { if(!confirm('Remover?')) return; S.del(id); arts=arts.filter(a=>a.id!==id); delete open[id]; render(); }
function updBtn() { document.getElementById('go-btn').disabled = !document.getElementById('url-inp').value.trim() && !pdf; }

/* pdf */
document.getElementById('pdf-inp').addEventListener('change', e => {
  const f = e.target.files[0]; if (!f) return;
  const r = new FileReader();
  r.onload = () => {
    pdf = {name:f.name, b64:r.result.split(',')[1]};
    document.getElementById('pdf-txt').textContent = f.name.length>16?f.name.slice(0,13)+'‚Ä¶':f.name;
    document.getElementById('pdf-lbl').classList.add('ok');
    updBtn();
  };
  r.readAsDataURL(f); e.target.value='';
});
document.getElementById('url-inp').addEventListener('input', updBtn);
document.getElementById('go-btn').addEventListener('click', analyze);

/* modal */
function showModal() { document.getElementById('key-inp').value=S.get('__key__')||''; document.getElementById('imp-status').style.display='none'; document.getElementById('modal').style.display='flex'; }
function hideModal() { document.getElementById('modal').style.display='none'; }
document.getElementById('btn-cfg').addEventListener('click', showModal);
document.getElementById('btn-close-modal').addEventListener('click', hideModal);
document.getElementById('btn-cancel').addEventListener('click', hideModal);
document.getElementById('modal').addEventListener('click', e => { if(e.target===e.currentTarget) hideModal(); });
document.getElementById('btn-save').addEventListener('click', () => {
  S.set('__key__', document.getElementById('key-inp').value.trim());
  const b=document.getElementById('btn-save'); b.textContent='‚úì Salvo!'; b.style.background='#059669';
  setTimeout(()=>{ b.textContent='Salvar'; b.style.background=''; hideModal(); },900);
});

/* export / import */
document.getElementById('btn-export').addEventListener('click', () => {
  const d={}; S.list('a:').forEach(k=>{d[k]=S.get(k);});
  const blob=new Blob([JSON.stringify({_at:new Date().toISOString(),data:d},null,2)],{type:'application/json'});
  const a=Object.assign(document.createElement('a'),{href:URL.createObjectURL(blob),download:`credito-${new Date().toISOString().slice(0,10)}.json`});
  a.click(); URL.revokeObjectURL(a.href);
});
document.getElementById('imp-inp').addEventListener('change', e => {
  const f=e.target.files[0]; if(!f) return;
  const st=document.getElementById('imp-status'); st.style.display='block'; st.style.color='#64748b'; st.textContent='Importando‚Ä¶';
  const r=new FileReader();
  r.onload=ev=>{
    try {
      const obj=JSON.parse(ev.target.result);
      const entries=obj.data?Object.entries(obj.data):Object.entries(obj).filter(([k])=>!k.startsWith('_'));
      let n=0; entries.forEach(([k,v])=>{if(k.startsWith('a:')){S.set(k,v);n++;}});
      st.style.color='#16a34a'; st.textContent=`‚úì ${n} mat√©rias importadas.`;
      setTimeout(()=>{hideModal();load();},900);
    } catch { st.style.color='#ef4444'; st.textContent='Arquivo inv√°lido.'; }
  };
  r.readAsText(f); e.target.value='';
});

load();
</script>
</body>
</html>
